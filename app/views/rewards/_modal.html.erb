<!-- giftable here really is only ever an invitation. -->
<div id="gift-card-modal" class="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>Gift Cards:<%= @giftable.person.full_name %></h3>
        <h5>YTD Total: <span id='reward_total'><%= @giftable.person.reward_total %></span>
      </div>
      <div class="modal-body">
        <div id="error-div"></div>
          <% if @reward.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@reward.errors.count, "error") %> prohibited this reward from being saved:</h2>

              <ul>
              <% @reward.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
              </ul>
            </div>
          <% end %>
        <h4>Assigned Cards</h4>
        <%= render partial: 'rewards/mini_view',
              locals: { rewards: @giftable.rewards } %>
        <hr>
        <h4>Available Cards</h4>
        <div class="input-group">
          <input type="text" id='card-search' class="form-control has-clear" placeholder="filter cards">
          <span class="input-group-btn form-control-clear">
            <button class="btn btn-secondary" type="button">Clear</button>
          </span>
        </div>
        <div class='gift_cards'>
          <table class='table table-striped'>
            <thead>
              <th>Batch</th>
              <th>Last 4</th>
              <th>Sequence</th>
              <th>Amount</th>
              <% if current_user.admin? %>
              <th>User</th>
              <% end %>
              <th>Reason</th>
              <th>Add</th>
            </thead>
            <tbody id='gift-cards-mini'>
              <%= render partial: "gift_cards/gift_card_mini",
                     collection: @card_activations, 
                     as: :card_activation %>
            </tbody>
          </table>
        </div>
        <!--  TODO -->
        <%= button_tag 'Manually Enter Cash Card', 
          onclick: '$("#manual-card-form").toggle()', 
          class: 'btn'%>
        <div id='manual-card-form' style='display:none'>
              <%= form_for( @reward, remote: true) do |form| %>
                <%= form.hidden_field :person_id, value: @giftable.person_id %>
                <%= form.hidden_field :giftable_id, value: @giftable.id %>
                <%= form.hidden_field :giftable_type, value: @giftable.class.to_s %>
                <%= form.hidden_field :card_activation_id %>
                <table>
                  <thead>
                    <tr>
                      <th>Reason</th>
                      <th>Sequence #</th>
                      <th>Card #</th>
                      <th>Batch</th>
                      <th>Expiration</th>
                      <th>Amount</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>

                <td>
                <%= form.select :reason,
                        Reward.reasons.keys.to_a,
                        { prompt: "Reason", selected: 'interview' },
                          class: 'input-small',
                          id: "new-reason"
                         %>
                </td><td>
                <%= form.text_field :sequence_number,
                        placeholder: "Sequence",
                        class: 'input-mini',
                        id: "new-sequencenumber" %>
                </td><td>
                <%= form.text_field :reward_number,
                        placeholder: "Card #",
                        class: 'input-mini',
                        id: "new-cardnumber" %>
                </td><td>
                <%= form.text_field :batch_id,
                        placeholder: "BatchID",
                        class: 'input-mini',
                        id: "new-batchid",
                        value: @last_reward.batch_id %>
                </td><td>
                <%= form.text_field :expiration_date,
                        placeholder: "MM/YY",
                        class: 'input-mini',
                        id: "new-expirationdate",
                        value: @last_reward.expiration_date %>
                </td><td>
                <%= form.text_field :amount,
                        placeholder: "####",
                        class: 'input-mini',
                        id: "new-amount" %>
                </td><td>

                <%= form.submit 'Add Gift Card', class: "btn btn-small", id: 'add-gift-card-button' %>
              </td>
            </tr>
          </tbody>
        </table>
      </div> <!-- End of hidden form-->
        <% end %>
      </div> <!-- modal body end -->
      <div class="modal-footer">
        <a href="#" class="btn close" data-dismiss="modal" aria-hidden="true">  Close
        </a>
      </div>
    </div>
  </div>
</div>
